<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
        <meta name="description" content="">
        <meta name="author" content="">
        <title>note</title>
        <!-- Bootstrap core CSS -->
        <link rel="stylesheet" href="../../libs/bootstrap/css/bootstrap.min.css">
        <link rel="stylesheet" href="../../css/auth.css" />
    </head>
    <body>

        <div class="container">
            <div class="row">
                <div class="logo">
                    <h1>NOTEBLOG REGISTER</h1>
                </div>

            </div>
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3 main">
                    <div class="title">
                    	<div  class="">注册页面</div>
                    </div> 
                    <div  id="registerErrorMsg" class="error none"></div>
                    <form class="form-signin">
                        <label for="inputEmail">Email 地址</label>
                        <input type="email" id="inputEmail" class="form-control" placeholder="Email 地址" required autofocus>
                        <label for="inputPassword" >密码</label>
                        <input type="password" id="inputPassword" class="form-control" placeholder="密码" required>
                        
                        <label for="confirmPassword" >确认密码</label>
                        <input type="password" id="confirmPassword" class="form-control" placeholder="确认密码" required>

                        <div class="">
                            <button id="registerBtn" class="btn btn-default btn-primary" type="submit">注册</button>
                        </div>
                        <div class="line line-dashed"></div>
                        <p class="text-muted text-center"><small>已有帐户</small></p>
                        <a href="login.html" class="btn btn-default btn-block">登录</a>
                    </form>
                </div>
            </div>
            <div class="row">
            </div>
        </div>


    </body>
    <script src="../../libs/jquery/jquery.min.js"></script>
    <script src="../../libs/bootstrap/js/bootstrap.min.js"></script>
    <script src="../../js/msg/msg_zh.js"></script>
    <script type="text/javascript">

 
$(function() {
	$("#inputEmail").focus();
	
	function showMsg(msg, id) {
		$("#registerErrorMsg").html(msg).show();
		if(id) {
			$("#" + id).focus();
		}
	}
	function hideMsg() {
		$("#loginMsg").hide();
	}
	$("#registerBtn").click(function(e){
		e.preventDefault();
		var email = $("#inputEmail").val();
		var pwd = $("#inputPassword").val();
		var pwd2 = $("#confirmPassword").val();
		if(!email) {
			showMsg(getMsg("inputEmail"), "email");
			return;
		} else {
			var myreg = /^([a-zA-Z0-9]+[_|\_|\.|\-]?)*[a-zA-Z0-9\-_]+@([a-zA-Z0-9\-]+[_|\_|\.|\-]?)*[a-zA-Z0-9\-]+\.[0-9a-zA-Z]{2,6}$/;
			if(!myreg.test(email)) {
				showMsg(getMsg("wrongEmail"), "email");
				return;
			}
		}
		if(!pwd) {
			showMsg(getMsg("inputPassword"), "pwd");
			return;
		} else {
			if(pwd.length < 6) {
				showMsg(getMsg("notGoodPassword"), "pwd");
				return;
			}
		}
		if(!pwd2) {
			showMsg(getMsg("inputPassword2"), "pwd2");
			return;
		} else {
			if(pwd != pwd2) {
				showMsg(getMsg("confirmPassword"), "pwd2");
				return;
			}
		}
		
		$("#registerBtn").html(getMsg("ing")).addClass("disabled");
		
		var iu = "token";
		
		$.post("/auth/doregister", {email: email, pwd: pwd, iu: iu}, function(e) {
			$("#registerBtn").html(getMsg("register")).removeClass("disabled");
			if(e.ok) {
				$("#registerBtn").html(getMsg("registerSuccessAndRdirectToNote"));
				var from = $("#from").val() ||  "/note";
				location.href = from;
			} else {
				showMsg(e.msg, "email");
			}
		});
		
	});
});
</script>
</html>